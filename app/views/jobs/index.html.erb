<div class="container job-filtering">
  <%= form_tag '/', :method => 'get' do %>
    <div class="search-technologies d-flex flex-row">
      <div class="p-2">
        Technologies:
      </div>
      <div class="flex-grow-1 search-bar">
        <select class="js-technologies" name="technologies[]" multiple="multiple">
          <% @technologies.each do |technology| %>
            <option value="<%= technology.id %>"><%= technology.name.downcase.capitalize %></option>
          <% end %>
        </select>
      </div>
    </div>

    <div class="bottom-filtering d-flex flex-row">
      <div class="p-3">
        <% @levels.each do |level| %>
          <% isSelected = @selected_levels.include?(level.id) %>
          <button type="button" onclick="toggleCheckbox(this, 'level-<%= level.name.downcase %>')" class="<%= isSelected ? 'button-selected' : 'button-unselected' %> btn btn-primary"><%= level.name.downcase.capitalize %></button>
          <%= check_box_tag "levels[]", level.id, checked = isSelected, :class => 'checkbox', :id => "level-#{level.name.downcase}" -%>
        <% end %>
      </div>

      <div class="p-3">
        <% @stacks.each do |stack| %>
          <% isSelected = @selected_stacks.include?(stack.id) %>
          <button type="button" onclick="toggleCheckbox(this, 'stack-<%= stack.name.downcase %>')" class="<%= isSelected ? 'button-selected' : 'button-unselected' %> btn btn-primary"><%= stack.name.downcase.capitalize %></button>
          <%= check_box_tag "stacks[]", stack.id, checked =isSelected , :class => 'checkbox', :id => "stack-#{stack.name.downcase}"-%>
        <% end %>
      </div>

      <div class="p-3 search-button">
        <div class="col-sm-5 col-lg-4 form-group">
          <button type="submit" class="btn btn-primary">Search</button>
        </div>
      </div>
    </div>
  <% end %>
</div>

<div class="container job-listings">
  <h3 class="heading">We have found <span class="accent"><%= @jobs.count %></span> jobs</h3>
  <% @jobs.each do |job| %>
    <div class="job-listing">
      <div class="row">
        <div class="col-md-12 col-lg-6">
          <div class="row">
            <div class="col-2"><img src=<%= image_path('default-company-image.jpg') %> alt="Company Logo" class="img-fluid"></div>
            <div class="col-10">
              <h4 class="job__title"><a href=<%= job.job_link %>> <%= job.title.capitalize %></a></h4>
              <p class="job__company">
                <%= job.company.name.capitalize %>
              </p>
            </div>
          </div>
        </div>
        <div class="col-10 col-md-3 col-lg-2 ml-auto"><i class="fa fa-map-marker job__technologies"></i><%= job.technologies.map{|t| t.name.capitalize}.join(", ") %></div>
        <div class="col-10 col-md-3 col-lg-3 ml-auto">
          <p>Posted <%= time_ago_in_words(job.published_date).remove("over") %> ago</p>
        </div>
      </div>
    </div>
  <% end %>
</div>
