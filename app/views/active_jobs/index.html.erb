<%= javascript_tag do %>
  window.allJobs = '<%= @jobs_to_show.to_json.html_safe %>';
<% end %>

<div class="search-container">
  <div class="search-box container w-100">

    <div class="page-title-container search-box-row row">
      <h1 class="page-title">Find your first developer job</h1>
    </div>

    <div class="stacks search-box-row row justify-content-md-center">
      <div class="col-4 col-lg-2">Show me:</div>
      <div class="col-8">
        <div class="row stack-options" id="js-stack-checkboxes">
          <% @stacks.each do |stack| %>
            <div class="col-3">
              <div class="row">
                <div class="stack-checkbox-container">
                  <%= check_box_tag "stacks[]", stack.id, checked = true, {name: 'js-stacks-cb', value: "js-stacks-cb_#{stack.id}", class: 'stack-checkbox'} -%>
                </div>
                <div class="stack-name">
                  <%= stack.name.downcase.capitalize %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div class="location-search-container">
      <%= form_tag '/search', :method => 'get' do %>
        <div class="area-search search-box-row row justify-content-md-center">
          <div class="col-4 col-lg-2">
            <%= label_tag(:location_area, "Area:") %>
          </div>
          <div class="col-8">
            <%= text_field_tag(:location_area, nil, :placeholder => 'Town, City or Area') %>
          </div>
        </div>

        <div class="postcode-search search-box-row row justify-content-md-center">
          <div class="col-4 col-lg-2">
            <%= label_tag(:location_postcode, "Postcode:") %>
          </div>
          <div class="col-8">
            <%= text_field_tag(:location_postcode, nil, :placeholder => '(Optional)') %>
          </div>
        </div>
        <div class="location-range search-box-row row justify-content-md-center">
          <div class="col-4 col-lg-2">
            <label for="location-dropdown">Within:</label>
          </div>
          <div class="col-8">
            <select name="location-dropdown" id="location-range">
              <option value="2">2 miles</option>
              <option value="5">5 miles</option>
              <option value="10">10 miles</option>
              <option value="25" selected>25 miles</option>
            </select>
            <%= button_tag("Go", class: 'search-button') %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>

<div class="container">
  <h3 class="heading">We have found <span class="accent jobs-count" id="js-jobs-count"><%= @jobs_to_show.count %></span> jobs</h3>
  <div id="js-job-listings-container">
    <% @jobs_to_show.each do |job| %>
      <div class="card job-card">
        <div class="card-header">
          <h5 class="card-title job-title"><%= job["title"].capitalize %></h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col 2">
              <h5 class="card-text job-company"><%= job["company_name"].capitalize %></h5>
            </div>
            <div class="col 10">
              <div class="card-text text-right">
                <a href=<%= job["job_link"] %> class="view-job-button">View Job</a>
              </div>
            </div>
          </div>
          <p class="card-text job-location"><%= job["location"] %></p>
        </div>
        <div class="card-footer">
          <p class="card-text text-right"><%= Date.parse(job["published_date"]) < Date.today - 30 ? "Posted over 30 days ago" : "Posted #{time_ago_in_words(job["published_date"]).remove("over")} ago" %></p>
        </div>
      </div>
    <% end %>
  </div>
</div>
